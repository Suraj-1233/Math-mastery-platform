datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id                 String    @id @default(cuid())
  name               String?
  email              String    @unique
  password           String?   // Hashed
  role               String    @default("USER")
  subscriptionStatus String    @default("FREE")
  createdAt          DateTime  @default(now())
  
  progress           UserProgress[]
  testAttempts       UserTestAttempt[]
}

model Question {
  id                String     @id @default(cuid())
  text              String     // Markdown/LaTeX supported
  options           String     // Store JSON stringified array
  correctOptionIndex Int
  explanation       String?    // Detailed solution
  subject           String
  difficulty        String     @default("MEDIUM")
  examType          String     // e.g., "SSC_CGL", "RAILWAY"
  tags              String?    // Store comma-separated tags
  isPremium         Boolean    @default(false)
  createdAt         DateTime   @default(now())

  userProgress      UserProgress[]
}

model UserProgress {
  id          String   @id @default(cuid())
  userId      String
  questionId  String
  status      String   // "CORRECT", "WRONG", "BOOKMARKED"
  
  isSolved    Boolean  @default(false)
  isCorrect   Boolean  @default(false)
  isBookmarked Boolean @default(false)
  
  attemptedAt DateTime @default(now())
  timeTaken   Int?     // Seconds
  
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  question    Question @relation(fields: [questionId], references: [id], onDelete: Cascade)

  @@unique([userId, questionId])
  @@index([userId, isBookmarked])
  @@index([userId, isSolved])
}


model UserTestAttempt {
  id          String   @id @default(cuid())
  userId      String
  testId      String
  score       Float
  accuracy    Float
  rank        Int?
  answersJson String     // Store JSON stringified map of { questionId: selectedIndex }
  startedAt   DateTime @default(now())
  completedAt DateTime?

  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}
